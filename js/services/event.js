"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.registerEvent = void 0;

var _debounce = _interopRequireDefault(require("debounce"));

var _constant = require("../constant");

var _ = require("./");

var _utils = require("../utils");

const registerEvent = handler => {
  if (!handler) throw new Error(_constant.errors.event.missingHandler);
  const config = (0, _.getConfig)();
  const {
    extensionAttr,
    debounceDelay
  } = config;
  const tagName = (0, _utils.getTagNameByElement)(handler);
  const tagType = handler.getAttribute('type');
  const event = (0, _utils.getEventByTagName)(tagName, tagType);
  const url = (0, _utils.getUrlByHandler)(handler);
  const extensionId = handler.getAttribute(extensionAttr);

  const handleRequest = async e => {
    e.preventDefault();
    const target = extensionId || url || '';
    await (0, _.makeRequest)(target);
  };

  handler.addEventListener(event, (0, _utils.isTagWriteable)(tagName, tagType) ? (0, _debounce.default)(handleRequest, debounceDelay) : handleRequest);
};

exports.registerEvent = registerEvent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zZXJ2aWNlcy9ldmVudC50cyJdLCJuYW1lcyI6WyJyZWdpc3RlckV2ZW50IiwiaGFuZGxlciIsIkVycm9yIiwiZXJyb3JzIiwiZXZlbnQiLCJtaXNzaW5nSGFuZGxlciIsImNvbmZpZyIsImV4dGVuc2lvbkF0dHIiLCJkZWJvdW5jZURlbGF5IiwidGFnTmFtZSIsInRhZ1R5cGUiLCJnZXRBdHRyaWJ1dGUiLCJ1cmwiLCJleHRlbnNpb25JZCIsImhhbmRsZVJlcXVlc3QiLCJlIiwicHJldmVudERlZmF1bHQiLCJ0YXJnZXQiLCJhZGRFdmVudExpc3RlbmVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFHTyxNQUFNQSxhQUFhLEdBQUlDLE9BQUQsSUFBc0I7QUFDbEQsTUFBSSxDQUFDQSxPQUFMLEVBQWMsTUFBTSxJQUFJQyxLQUFKLENBQVVDLGlCQUFPQyxLQUFQLENBQWFDLGNBQXZCLENBQU47QUFDZCxRQUFNQyxNQUFNLEdBQUcsa0JBQWY7QUFDQSxRQUFNO0FBQUVDLElBQUFBLGFBQUY7QUFBaUJDLElBQUFBO0FBQWpCLE1BQW1DRixNQUF6QztBQUNBLFFBQU1HLE9BQU8sR0FBRyxnQ0FBb0JSLE9BQXBCLENBQWhCO0FBQ0EsUUFBTVMsT0FBTyxHQUFHVCxPQUFPLENBQUNVLFlBQVIsQ0FBcUIsTUFBckIsQ0FBaEI7QUFDQSxRQUFNUCxLQUFLLEdBQUcsOEJBQWtCSyxPQUFsQixFQUEyQkMsT0FBM0IsQ0FBZDtBQUNBLFFBQU1FLEdBQUcsR0FBRyw0QkFBZ0JYLE9BQWhCLENBQVo7QUFDQSxRQUFNWSxXQUFXLEdBQUdaLE9BQU8sQ0FBQ1UsWUFBUixDQUFxQkosYUFBckIsQ0FBcEI7O0FBRUEsUUFBTU8sYUFBYSxHQUFHLE1BQU9DLENBQVAsSUFBb0I7QUFDekNBLElBQUFBLENBQUMsQ0FBQ0MsY0FBRjtBQUNBLFVBQU1DLE1BQU0sR0FBR0osV0FBVyxJQUFJRCxHQUFmLElBQXNCLEVBQXJDO0FBQ0EsVUFBTSxtQkFBWUssTUFBWixDQUFOO0FBQ0EsR0FKRDs7QUFNQWhCLEVBQUFBLE9BQU8sQ0FBQ2lCLGdCQUFSLENBQ0NkLEtBREQsRUFFQywyQkFBZUssT0FBZixFQUF3QkMsT0FBeEIsSUFBbUMsdUJBQVNJLGFBQVQsRUFBd0JOLGFBQXhCLENBQW5DLEdBQTRFTSxhQUY3RTtBQUlBLENBcEJNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRlYm91bmNlIGZyb20gJ2RlYm91bmNlJ1xyXG5cclxuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnY29uc3RhbnQnXHJcbmltcG9ydCB7IG1ha2VSZXF1ZXN0LCBnZXRDb25maWcgfSBmcm9tICdzZXJ2aWNlcydcclxuaW1wb3J0IHsgZ2V0RXZlbnRCeVRhZ05hbWUsIGdldFRhZ05hbWVCeUVsZW1lbnQsIGdldFVybEJ5SGFuZGxlciwgaXNUYWdXcml0ZWFibGUgfSBmcm9tICd1dGlscydcclxuaW1wb3J0IHsgVGFnVHlwZSB9IGZyb20gJ21vZGVscydcclxuXHJcbmV4cG9ydCBjb25zdCByZWdpc3RlckV2ZW50ID0gKGhhbmRsZXI6IEVsZW1lbnQpID0+IHtcclxuXHRpZiAoIWhhbmRsZXIpIHRocm93IG5ldyBFcnJvcihlcnJvcnMuZXZlbnQubWlzc2luZ0hhbmRsZXIpXHJcblx0Y29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKClcclxuXHRjb25zdCB7IGV4dGVuc2lvbkF0dHIsIGRlYm91bmNlRGVsYXkgfSA9IGNvbmZpZ1xyXG5cdGNvbnN0IHRhZ05hbWUgPSBnZXRUYWdOYW1lQnlFbGVtZW50KGhhbmRsZXIpXHJcblx0Y29uc3QgdGFnVHlwZSA9IGhhbmRsZXIuZ2V0QXR0cmlidXRlKCd0eXBlJykgYXMgVGFnVHlwZVxyXG5cdGNvbnN0IGV2ZW50ID0gZ2V0RXZlbnRCeVRhZ05hbWUodGFnTmFtZSwgdGFnVHlwZSlcclxuXHRjb25zdCB1cmwgPSBnZXRVcmxCeUhhbmRsZXIoaGFuZGxlcilcclxuXHRjb25zdCBleHRlbnNpb25JZCA9IGhhbmRsZXIuZ2V0QXR0cmlidXRlKGV4dGVuc2lvbkF0dHIpXHJcblxyXG5cdGNvbnN0IGhhbmRsZVJlcXVlc3QgPSBhc3luYyAoZTogRXZlbnQpID0+IHtcclxuXHRcdGUucHJldmVudERlZmF1bHQoKVxyXG5cdFx0Y29uc3QgdGFyZ2V0ID0gZXh0ZW5zaW9uSWQgfHwgdXJsIHx8ICcnXHJcblx0XHRhd2FpdCBtYWtlUmVxdWVzdCh0YXJnZXQpXHJcblx0fVxyXG5cclxuXHRoYW5kbGVyLmFkZEV2ZW50TGlzdGVuZXIoXHJcblx0XHRldmVudCxcclxuXHRcdGlzVGFnV3JpdGVhYmxlKHRhZ05hbWUsIHRhZ1R5cGUpID8gZGVib3VuY2UoaGFuZGxlUmVxdWVzdCwgZGVib3VuY2VEZWxheSkgOiBoYW5kbGVSZXF1ZXN0LFxyXG5cdClcclxufVxyXG4iXX0=